<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora Costes 3D</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link rel="stylesheet" href="CSS/style.css">
</head>

<body>

    <div class="main-container">
        <h2 style="color: var(--primary);">Calculadora de costes de impresión 3D</h2>

        <div class="price-banner">
            <span>Coste total:</span>
            <span class="price-text" id="display-total">0.00 €</span>
        </div>

        <div class="step-card">
            <div class="step-header" onclick="toggleStep(this)">Información del Proyecto</div>
            <div class="step-body">
                <div class="row">
                    <div class="col">
                        <label>Cliente</label>
                        <input type="text" id="clientName" value="">
                    </div>
                    <div class="col">
                        <label>Proyecto / Pieza</label>
                        <input type="text" id="projectName" value="">
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        <label>Tiempo (Horas)</label>
                        <input type="number" id="h" value="0" placeholder="0">
                    </div>
                    <div class="col">
                        <label>Minutos</label>
                        <input type="number" id="m" value="0" placeholder="0">
                    </div>
                    <div class="col">
                        <label>Filamento usado (g)</label>
                        <input type="number" id="weight" value="0">
                    </div>
                </div>
            </div>
        </div>

        <div class="step-card">
            <div class="step-header" onclick="toggleStep(this)">Filamento</div>
            <div class="step-body">
                <div class="row">
                    <div class="col">
                        <label>Precio Bobina (€)</label>
                        <input type="number" id="fPrice" value="0">
                    </div>
                    <div class="col">
                        <label>Peso Bobina (g)</label>
                        <input type="number" id="fWeight" value="1000">
                    </div>
                    <div class="col">
                        <label>Desperdicio (%)</label>
                        <input type="number" id="waste" value="0">
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        <label>Material</label>
                        <select id="materialType">
                            <option>PLA</option>
                            <option>PETG</option>
                            <option selected>ABS</option>
                            <option>TPU</option>
                            <option>ASA</option>
                            <option>Resina</option>
                        </select>
                    </div>
                    <div class="col">
                        <label>Diámetro</label>
                        <select>
                            <option>1.75 mm</option>
                            <option>2.85 mm</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <div class="step-card collapsed">
            <div class="step-header" onclick="toggleStep(this)">Electricidad</div>
            <div class="step-body">
                <div class="check-group">
                    <input type="checkbox" id="useElec">
                    <label for="useElec" style="margin:0; cursor:pointer;">Incluir coste eléctrico</label>
                </div>
                <div class="row">
                    <div class="col"><label>Consumo (W)</label><input type="number" id="watt" value="0"></div>
                    <div class="col"><label>Precio luz (€/kWh)</label><input type="number" id="kwhPrice" value="0.00">
                    </div>
                </div>
            </div>
        </div>

        <div class="step-card collapsed">
            <div class="step-header" onclick="toggleStep(this)">Mano de obra</div>
            <div class="step-body">
                <div class="check-group">
                    <input type="checkbox" id="useLabor">
                    <label for="useLabor" style="margin:0; cursor:pointer;">Incluir mano de obra</label>
                </div>
                <div class="row">
                    <div class="col"><label>Tiempo dedicación (min)</label><input type="number" id="prepMin" value="0">
                    </div>
                    <div class="col"><label>Precio hora (€/h)</label><input type="number" id="laborPrice" value="0">
                    </div>
                </div>
            </div>
        </div>

        <div class="step-card collapsed">
            <div class="step-header" onclick="toggleStep(this)">Amortización</div>
            <div class="step-body">
                <div class="check-group">
                    <input type="checkbox" id="useAmort">
                    <label for="useAmort" style="margin:0; cursor:pointer;">Incluir amortización máquina</label>
                </div>
                <div class="row">
                    <div class="col"><label>Coste impresora (€)</label><input type="number" id="printerCost" value="0">
                    </div>
                    <div class="col"><label>Meses amortización</label><input type="number" id="amortMonths" value="0">
                    </div>
                </div>
            </div>
        </div>

        <div class="step-card">
            <div class="step-header" onclick="toggleStep(this)">Margen de beneficio</div>
            <div class="step-body">
                <div class="col" style="max-width: 200px;">
                    <label>Margen (%)</label>
                    <input type="number" id="profit" value="30">
                </div>
            </div>
        </div>

        <div class="actions">
            <button class="btn btn-calc" onclick="calculate()">Calcular</button>
            <button class="btn btn-pdf" onclick="generatePDF()"> Descargar PDF</button>
        </div>
    </div>

    <div id="pdf-container">
        <div id="invoice-template">
            <div class="pdf-title">FACTURA DE TRABAJO 3D</div>
            <div class="pdf-meta">
                <p><strong>Cliente:</strong> <span id="pdf-client"></span></p>
                <p><strong>Proyecto:</strong> <span id="pdf-project"></span></p>
                <p><strong>Fecha:</strong> <span id="pdf-date"></span></p>
            </div>
            <table class="pdf-table">
                <thead>
                    <tr>
                        <th style="width: 70%;">Concepto / Material</th>
                        <th style="width: 30%; text-align: right;">Coste</th>
                    </tr>
                </thead>
                <tbody id="pdf-rows"></tbody>
                <tfoot>
                    <tr class="total-row">
                        <td>PRECIO FINAL</td>
                        <td style="text-align: right;" id="pdf-total"></td>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>

    <script src="JS/script.js"></script>
</body>

</html>